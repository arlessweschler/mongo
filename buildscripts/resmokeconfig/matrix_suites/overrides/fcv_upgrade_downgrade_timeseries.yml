# Overrides for suites that perform timeseries upgrade/downgrade in background
- name: replicaset_exclude_files
  value:
    exclude_files:
      # TODO SERVER-105925 collMod is racy with timeseries upgrade/downgrade
      - jstests/core/catalog/list_collections_correctness.js
      - jstests/core/query/change_streams_pre_and_post_images_in_create_and_collmod.js
      - jstests/core/timeseries/ddl/bucket_granularity.js
      - jstests/core/timeseries/ddl/bucket_timestamp_rounding.js
      - jstests/core/timeseries/ddl/timeseries_collection_uuid.js
      - jstests/core/timeseries/ddl/timeseries_collmod.js
      - jstests/core/timeseries/ddl/timeseries_collmod_timeseries_options.js
      - jstests/core/timeseries/ddl/timeseries_expire_collmod.js
      - jstests/core/timeseries/ddl/timeseries_index.js
      - jstests/core/timeseries/ddl/timeseries_special_indexes_metadata.js
      - jstests/core/timeseries/pbt/timeseries_add_fields_pbt.js
      - jstests/core/timeseries/pbt/timeseries_agg_stages_basic_behavior_pbt.js
      - jstests/core/timeseries/pbt/timeseries_cache_usage_pbt.js
      - jstests/core/timeseries/pbt/timeseries_match_pbt.js
      - jstests/core/timeseries/pbt/timeseries_project_pbt.js
      - jstests/core/timeseries/query/bucket_unpacking_group_reorder_fixed_buckets.js
      - jstests/core/timeseries/query/bucket_unpacking_with_match_fixed_buckets.js
      - jstests/core/timeseries/query/timeseries_mixed_bucket_schema.js
      - jstests/core/timeseries/query/timeseries_out_non_sharded.js
      - jstests/core/timeseries/write/timeseries_insert_mixed_schema_bucket.js
      - jstests/core/timeseries/write/timeseries_update_mixed_schema_bucket.js
      - jstests/core/timeseries/write/timeseries_viewless_oplog_entries.js

      # TODO SERVER-120052 adapt following test to work with concurrent timeseries upgrade/downgrade
      - jstests/core/timeseries/ddl/rename_timeseries.js

      # TODO SERVER-120235 re-enable tests that uses timeseries sub-pipeline (e.g. graphLookup)
      # on timeseries collections
      - jstests/core/timeseries/query/timeseries_graph_lookup.js
      - jstests/core/timeseries/geo/timeseries_geonear_lookup.js
      - jstests/core/timeseries/query/timeseries_lookup.js

- name: replicaset_exclude_tags
  value:
    exclude_with_any_tags:
      # timeseries upgrade/downgrade cause getMore requests over timeseries collections
      # to be interrupted with InterruptedDueToTimeseriesUpgradeDowngrade error.
      # getMore requests are not idempotent and thus can't be retried.
      - requires_getmore
      # non retryable write commands can't be retry when
      # they fail with InterruptedDueToTimeseriesUpgradeDowngrade error.
      - requires_non_retryable_writes
      # multi updates are not retryable (e.g. updateMany, deleteMany) thus they can't be retry when
      # they fail with InterruptedDueToTimeseriesUpgradeDowngrade error.
      # TODO SPM-1153 remove this tag
      - requires_multi_updates
      # Collstats could miss timeseries section when executed concurrently with timeseries upgrade/downgrade
      # TODO SERVER-120247 remove this tag once the bug is fixed
      - requires_collstats
